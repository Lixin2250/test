<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏´‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    table { border-collapse: collapse; margin-top: 1rem; width: 100%; }
    td, th { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    .person-checkbox { display: inline-block; width: 90px; }
  </style>
</head>
<body>
  <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>
  <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <input type="date" id="date" /></label><br><br>
  <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: <input type="text" id="desc" /></label><br><br>
  <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó): <input type="number" id="amount" /></label><br><br>
  <strong>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢:</strong><br>
  <div id="people"></div><br>
  <button onclick="addExpense()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
  <hr>
  <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
  <ul id="expenseList"></ul>
  <button onclick="calculate()">üìä ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î</button>
  <div id="result"></div>

<script>

let expenses = [];

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
if (localStorage.getItem("expenses")) {
  expenses = JSON.parse(localStorage.getItem("expenses"));
  updateExpenseList();
  localStorage.setItem("expenses", JSON.stringify(expenses));
}

const peopleCount = 20;

// ‡∏™‡∏£‡πâ‡∏≤‡∏á checkbox ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô 1-20
const peopleDiv = document.getElementById("people");
for (let i = 1; i <= peopleCount; i++) {
  peopleDiv.innerHTML += `<label class='person-checkbox'><input type='checkbox' value='${i}'/> ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${i}</label>`;
}

function addExpense() {
  const date = document.getElementById("date").value;
  const desc = document.getElementById("desc").value;
  const amount = parseFloat(document.getElementById("amount").value);
  const checkboxes = document.querySelectorAll("#people input[type=checkbox]:checked");
  const sharedBy = Array.from(checkboxes).map(cb => parseInt(cb.value));

  if (!date || !amount || sharedBy.length === 0) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
    return;
  }

  expenses.push({ date, desc, amount, sharedBy });
  updateExpenseList();
  localStorage.setItem("expenses", JSON.stringify(expenses));
}

function updateExpenseList() {
  const list = document.getElementById("expenseList");
  list.innerHTML = "";
  expenses.forEach((ex, i) => {
    list.innerHTML += `<li>${ex.date} - ${ex.desc || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"}: ${ex.amount} ‡∏ö‡∏≤‡∏ó (‡∏´‡∏≤‡∏£ ${ex.sharedBy.length} ‡∏Ñ‡∏ô)</li>`;
  });
}

function calculate() {
  const result = {};
  const monthly = {};

  expenses.forEach(ex => {
    const perPerson = ex.amount / ex.sharedBy.length;
    const month = ex.date.slice(0, 7); // yyyy-mm

    ex.sharedBy.forEach(pid => {
      if (!result[pid]) result[pid] = 0;
      if (!monthly[month]) monthly[month] = {};
      if (!monthly[month][pid]) monthly[month][pid] = 0;

      result[pid] += perPerson;
      monthly[month][pid] += perPerson;
    });
  });

  let html = "<h3>üìÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>";
  for (const month in monthly) {
    html += `<h4>${month}</h4><table><tr><th>‡∏Ñ‡∏ô</th><th>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</th></tr>`;
    for (const pid in monthly[month]) {
      html += `<tr><td>‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${pid}</td><td>${monthly[month][pid].toFixed(2)}</td></tr>`;
    }
    html += "</table>";
  }

  html += "<h3>üßÆ ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3><table><tr><th>‡∏Ñ‡∏ô</th><th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr>";
  for (const pid in result) {
    html += `<tr><td>‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${pid}</td><td>${result[pid].toFixed(2)}</td></tr>`;
  }
  html += "</table>";
  document.getElementById("result").innerHTML = html;
}
</script>

<br><button onclick="clearData()">üóë ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
<script>
function clearData() {
  if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
    localStorage.removeItem("expenses");
    expenses = [];
    updateExpenseList();
    document.getElementById("result").innerHTML = "";
  }
}
</script>
</body>

</html>
